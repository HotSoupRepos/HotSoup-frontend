{"version":3,"sources":["../../../src/export/printBundleSizes.ts"],"sourcesContent":["import { Platform } from '@expo/config';\nimport { BundleOutput } from '@expo/dev-server';\nimport chalk from 'chalk';\nimport prettyBytes from 'pretty-bytes';\nimport table from 'text-table';\n\nimport * as Log from '../log';\nimport { stripAnsi } from '../utils/ansi';\nimport { learnMore } from '../utils/link';\n\nexport function printBundleSizes(bundles: Partial<Record<Platform, BundleOutput>>) {\n  const files: [string, string | Uint8Array][] = [];\n\n  if (bundles.ios?.hermesBytecodeBundle) {\n    files.push(['index.ios.js (Hermes)', bundles.ios.hermesBytecodeBundle]);\n  } else if (bundles.ios?.code) {\n    files.push(['index.ios.js', bundles.ios.code]);\n  }\n  if (bundles.android?.hermesBytecodeBundle) {\n    files.push(['index.android.js (Hermes)', bundles.android.hermesBytecodeBundle]);\n  } else if (bundles.android?.code) {\n    files.push(['index.android.js', bundles.android.code]);\n  }\n\n  // Account for inline source maps\n  if (bundles.ios?.hermesSourcemap) {\n    files.push([chalk.dim('index.ios.js.map (Hermes)'), bundles.ios.hermesSourcemap]);\n  } else if (bundles.ios?.map) {\n    files.push([chalk.dim('index.ios.js.map'), bundles.ios.map]);\n  }\n  if (bundles.android?.hermesSourcemap) {\n    files.push([chalk.dim('index.android.js.map (Hermes)'), bundles.android.hermesSourcemap]);\n  } else if (bundles.android?.map) {\n    files.push([chalk.dim('index.android.js.map'), bundles.android.map]);\n  }\n\n  Log.log();\n  Log.log(createFilesTable(files));\n  Log.log();\n  Log.log(\n    chalk`ðŸ’¡ JavaScript bundle sizes affect startup time. {dim ${learnMore(\n      `https://expo.fyi/javascript-bundle-sizes`\n    )}}`\n  );\n  Log.log();\n\n  return files;\n}\n\nexport function createFilesTable(files: [string, string | Uint8Array][]): string {\n  const tableData = files.map((item, index) => {\n    const fileBranch = index === 0 ? 'â”Œ' : index === files.length - 1 ? 'â””' : 'â”œ';\n\n    return [`${fileBranch} ${item[0]}`, prettyBytes(Buffer.byteLength(item[1], 'utf8'))];\n  });\n  return table([['Bundle', 'Size'].map((v) => chalk.underline(v)), ...tableData], {\n    align: ['l', 'r'],\n    stringLength: (str) => stripAnsi(str)?.length ?? 0,\n  });\n}\n"],"names":["printBundleSizes","createFilesTable","Log","bundles","files","ios","hermesBytecodeBundle","push","code","android","hermesSourcemap","chalk","dim","map","log","learnMore","tableData","item","index","fileBranch","length","prettyBytes","Buffer","byteLength","stripAnsi","table","v","underline","align","stringLength","str"],"mappings":"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"}