{"version":3,"sources":["../../../src/export/createMetadataJson.ts"],"sourcesContent":["import type { BundleOutput } from '@expo/dev-server';\nimport path from 'path';\n\nexport type BundlePlatform = 'android' | 'ios';\n\ntype PlatformMetadataAsset = { path: string; ext: string };\n\ntype PlatformMetadata = { bundle: string; assets: PlatformMetadataAsset[] };\n\ntype FileMetadata = {\n  [key in BundlePlatform]: PlatformMetadata;\n};\n\nexport function createMetadataJson({\n  bundles,\n  fileNames,\n}: {\n  bundles: Partial<Record<BundlePlatform, Pick<BundleOutput, 'assets'>>>;\n  fileNames: Record<string, string>;\n}): {\n  version: 0;\n  bundler: 'metro';\n  fileMetadata: FileMetadata;\n} {\n  // Build metadata.json\n  return {\n    version: 0,\n    bundler: 'metro',\n    fileMetadata: Object.entries(bundles).reduce<Record<string, Partial<PlatformMetadata>>>(\n      (metadata, [platform, bundle]) => ({\n        ...metadata,\n        [platform]: {\n          // Get the filename for each platform's bundle.\n          bundle: path.join('bundles', fileNames[platform]!),\n          // Collect all of the assets and convert them to the serial format.\n          assets: bundle.assets\n            .map((asset) =>\n              // Each asset has multiple hashes which we convert and then flatten.\n              asset.fileHashes.map((hash) => ({\n                path: path.join('assets', hash),\n                ext: asset.type,\n              }))\n            )\n            .flat(),\n        },\n      }),\n      {}\n    ) as FileMetadata,\n  };\n}\n"],"names":["createMetadataJson","bundles","fileNames","version","bundler","fileMetadata","Object","entries","reduce","metadata","platform","bundle","path","join","assets","map","asset","fileHashes","hash","ext","type","flat"],"mappings":"AAAA;;;;QAagBA,kBAAkB,GAAlBA,kBAAkB;AAZjB,IAAA,KAAM,kCAAN,MAAM,EAAA;;;;;;AAYhB,SAASA,kBAAkB,CAAC,EACjCC,OAAO,CAAA,EACPC,SAAS,CAAA,EAIV,EAIC;IACA,sBAAsB;IACtB,OAAO;QACLC,OAAO,EAAE,CAAC;QACVC,OAAO,EAAE,OAAO;QAChBC,YAAY,EAAEC,MAAM,CAACC,OAAO,CAACN,OAAO,CAAC,CAACO,MAAM,CAC1C,CAACC,QAAQ,EAAE,CAACC,QAAQ,EAAEC,MAAM,CAAC,GAAK,CAAC;gBACjC,GAAGF,QAAQ;gBACX,CAACC,QAAQ,CAAC,EAAE;oBACV,+CAA+C;oBAC/CC,MAAM,EAAEC,KAAI,QAAA,CAACC,IAAI,CAAC,SAAS,EAAEX,SAAS,CAACQ,QAAQ,CAAC,CAAE;oBAClD,mEAAmE;oBACnEI,MAAM,EAAEH,MAAM,CAACG,MAAM,CAClBC,GAAG,CAAC,CAACC,KAAK,GACT,oEAAoE;wBACpEA,KAAK,CAACC,UAAU,CAACF,GAAG,CAAC,CAACG,IAAI,GAAK,CAAC;gCAC9BN,IAAI,EAAEA,KAAI,QAAA,CAACC,IAAI,CAAC,QAAQ,EAAEK,IAAI,CAAC;gCAC/BC,GAAG,EAAEH,KAAK,CAACI,IAAI;6BAChB,CAAC;wBAAA,CAAC;oBAAA,CACJ,CACAC,IAAI,EAAE;iBACV;aACF,CAAC;QAAA,EACF,EAAE,CACH;KACF,CAAC;CACH"}