{"version":3,"sources":["../../../../src/run/ios/launchApp.ts"],"sourcesContent":["import chalk from 'chalk';\nimport path from 'path';\n\nimport { AppleDeviceManager } from '../../start/platforms/ios/AppleDeviceManager';\nimport { SimulatorLogStreamer } from '../../start/platforms/ios/simctlLogging';\nimport { DevServerManager } from '../../start/server/DevServerManager';\nimport { parsePlistAsync } from '../../utils/plist';\nimport { profile } from '../../utils/profile';\nimport * as XcodeBuild from './XcodeBuild';\nimport { BuildProps } from './XcodeBuild.types';\nimport { getAppDeltaDirectory, installOnDeviceAsync } from './appleDevice/installOnDeviceAsync';\n\n/** Install and launch the app binary on a device. */\nexport async function launchAppAsync(\n  binaryPath: string,\n  manager: DevServerManager,\n  props: Pick<BuildProps, 'isSimulator' | 'device' | 'shouldStartBundler'>\n) {\n  const appId = await profile(getBundleIdentifierForBinaryAsync)(binaryPath);\n\n  if (!props.isSimulator) {\n    await profile(installOnDeviceAsync)({\n      bundleIdentifier: appId,\n      bundle: binaryPath,\n      appDeltaDirectory: getAppDeltaDirectory(appId),\n      udid: props.device.udid,\n      deviceName: props.device.name,\n    });\n    return;\n  }\n\n  XcodeBuild.logPrettyItem(chalk`{bold Installing} on ${props.device.name}`);\n\n  const device = await AppleDeviceManager.resolveAsync({ device: props.device });\n  await device.installAppAsync(binaryPath);\n\n  XcodeBuild.logPrettyItem(chalk`{bold Opening} on ${device.name} {dim (${appId})}`);\n\n  if (props.shouldStartBundler) {\n    await SimulatorLogStreamer.getStreamer(device.device, {\n      appId,\n    }).attachAsync();\n  }\n\n  await manager.getDefaultDevServer().openCustomRuntimeAsync(\n    'simulator',\n    {\n      applicationId: appId,\n    },\n    { device }\n  );\n}\n\nasync function getBundleIdentifierForBinaryAsync(binaryPath: string): Promise<string> {\n  const builtInfoPlistPath = path.join(binaryPath, 'Info.plist');\n  const { CFBundleIdentifier } = await parsePlistAsync(builtInfoPlistPath);\n  return CFBundleIdentifier;\n}\n"],"names":["launchAppAsync","XcodeBuild","binaryPath","manager","props","appId","profile","getBundleIdentifierForBinaryAsync","isSimulator","installOnDeviceAsync","bundleIdentifier","bundle","appDeltaDirectory","getAppDeltaDirectory","udid","device","deviceName","name","logPrettyItem","chalk","AppleDeviceManager","resolveAsync","installAppAsync","shouldStartBundler","SimulatorLogStreamer","getStreamer","attachAsync","getDefaultDevServer","openCustomRuntimeAsync","applicationId","builtInfoPlistPath","path","join","CFBundleIdentifier","parsePlistAsync"],"mappings":"AAAA;;;;QAasBA,cAAc,GAAdA,cAAc;AAblB,IAAA,MAAO,kCAAP,OAAO,EAAA;AACR,IAAA,KAAM,kCAAN,MAAM,EAAA;AAEY,IAAA,mBAA8C,WAA9C,8CAA8C,CAAA;AAC5C,IAAA,cAAyC,WAAzC,yCAAyC,CAAA;AAE9C,IAAA,MAAmB,WAAnB,mBAAmB,CAAA;AAC3B,IAAA,QAAqB,WAArB,qBAAqB,CAAA;AACjCC,IAAAA,UAAU,mCAAM,cAAc,EAApB;AAEqC,IAAA,qBAAoC,WAApC,oCAAoC,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGxF,eAAeD,cAAc,CAClCE,UAAkB,EAClBC,OAAyB,EACzBC,KAAwE,EACxE;IACA,MAAMC,KAAK,GAAG,MAAMC,CAAAA,GAAAA,QAAO,AAAmC,CAAA,QAAnC,CAACC,iCAAiC,CAAC,CAACL,UAAU,CAAC,AAAC;IAE3E,IAAI,CAACE,KAAK,CAACI,WAAW,EAAE;QACtB,MAAMF,CAAAA,GAAAA,QAAO,AAAsB,CAAA,QAAtB,CAACG,qBAAoB,qBAAA,CAAC,CAAC;YAClCC,gBAAgB,EAAEL,KAAK;YACvBM,MAAM,EAAET,UAAU;YAClBU,iBAAiB,EAAEC,CAAAA,GAAAA,qBAAoB,AAAO,CAAA,qBAAP,CAACR,KAAK,CAAC;YAC9CS,IAAI,EAAEV,KAAK,CAACW,MAAM,CAACD,IAAI;YACvBE,UAAU,EAAEZ,KAAK,CAACW,MAAM,CAACE,IAAI;SAC9B,CAAC,CAAC;QACH,OAAO;KACR;IAEDhB,UAAU,CAACiB,aAAa,CAACC,MAAK,QAAA,CAAC,qBAAqB,EAAEf,KAAK,CAACW,MAAM,CAACE,IAAI,CAAC,CAAC,CAAC,CAAC;IAE3E,MAAMF,MAAM,GAAG,MAAMK,mBAAkB,mBAAA,CAACC,YAAY,CAAC;QAAEN,MAAM,EAAEX,KAAK,CAACW,MAAM;KAAE,CAAC,AAAC;IAC/E,MAAMA,MAAM,CAACO,eAAe,CAACpB,UAAU,CAAC,CAAC;IAEzCD,UAAU,CAACiB,aAAa,CAACC,MAAK,QAAA,CAAC,kBAAkB,EAAEJ,MAAM,CAACE,IAAI,CAAC,OAAO,EAAEZ,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC;IAEnF,IAAID,KAAK,CAACmB,kBAAkB,EAAE;QAC5B,MAAMC,cAAoB,qBAAA,CAACC,WAAW,CAACV,MAAM,CAACA,MAAM,EAAE;YACpDV,KAAK;SACN,CAAC,CAACqB,WAAW,EAAE,CAAC;KAClB;IAED,MAAMvB,OAAO,CAACwB,mBAAmB,EAAE,CAACC,sBAAsB,CACxD,WAAW,EACX;QACEC,aAAa,EAAExB,KAAK;KACrB,EACD;QAAEU,MAAM;KAAE,CACX,CAAC;CACH;AAED,eAAeR,iCAAiC,CAACL,UAAkB,EAAmB;IACpF,MAAM4B,kBAAkB,GAAGC,KAAI,QAAA,CAACC,IAAI,CAAC9B,UAAU,EAAE,YAAY,CAAC,AAAC;IAC/D,MAAM,EAAE+B,kBAAkB,CAAA,EAAE,GAAG,MAAMC,CAAAA,GAAAA,MAAe,AAAoB,CAAA,gBAApB,CAACJ,kBAAkB,CAAC,AAAC;IACzE,OAAOG,kBAAkB,CAAC;CAC3B"}