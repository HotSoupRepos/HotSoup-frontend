{"version":3,"sources":["../../../../src/api/rest/wrapFetchWithProgress.ts"],"sourcesContent":["import * as Log from '../../log';\nimport { FetchLike } from './client.types';\n\nexport function wrapFetchWithProgress(fetch: FetchLike): FetchLike {\n  return async (url, init) => {\n    const res = await fetch(url, init);\n    if (res.ok && init?.onProgress) {\n      const totalDownloadSize = res.headers.get('Content-Length');\n      const total = Number(totalDownloadSize);\n\n      if (!totalDownloadSize || isNaN(total) || total < 0) {\n        Log.warn(\n          'Progress callback not supported for network request because \"Content-Length\" header missing or invalid in response from URL:',\n          url.toString()\n        );\n        return res;\n      }\n\n      let length = 0;\n\n      res.body.on('data', (chunk) => {\n        length += chunk.length;\n        onProgress();\n      });\n\n      res.body.on('end', () => {\n        onProgress();\n      });\n\n      const onProgress = () => {\n        const progress = length / total;\n\n        init.onProgress?.({\n          progress,\n          total,\n          loaded: length,\n        });\n      };\n    }\n    return res;\n  };\n}\n"],"names":["wrapFetchWithProgress","Log","fetch","url","init","res","ok","onProgress","totalDownloadSize","headers","get","total","Number","isNaN","warn","toString","length","body","on","chunk","progress","loaded"],"mappings":"AAAA;;;;QAGgBA,qBAAqB,GAArBA,qBAAqB;AAHzBC,IAAAA,GAAG,mCAAM,WAAW,EAAjB;;;;;;;;;;;;;;;;;;;;;;AAGR,SAASD,qBAAqB,CAACE,KAAgB,EAAa;IACjE,OAAO,OAAOC,GAAG,EAAEC,IAAI,GAAK;QAC1B,MAAMC,GAAG,GAAG,MAAMH,KAAK,CAACC,GAAG,EAAEC,IAAI,CAAC,AAAC;QACnC,IAAIC,GAAG,CAACC,EAAE,IAAIF,CAAAA,IAAI,QAAY,GAAhBA,KAAAA,CAAgB,GAAhBA,IAAI,CAAEG,UAAU,CAAA,EAAE;YAC9B,MAAMC,iBAAiB,GAAGH,GAAG,CAACI,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAAC,AAAC;YAC5D,MAAMC,KAAK,GAAGC,MAAM,CAACJ,iBAAiB,CAAC,AAAC;YAExC,IAAI,CAACA,iBAAiB,IAAIK,KAAK,CAACF,KAAK,CAAC,IAAIA,KAAK,GAAG,CAAC,EAAE;gBACnDV,GAAG,CAACa,IAAI,CACN,8HAA8H,EAC9HX,GAAG,CAACY,QAAQ,EAAE,CACf,CAAC;gBACF,OAAOV,GAAG,CAAC;aACZ;YAED,IAAIW,MAAM,GAAG,CAAC,AAAC;YAEfX,GAAG,CAACY,IAAI,CAACC,EAAE,CAAC,MAAM,EAAE,CAACC,KAAK,GAAK;gBAC7BH,MAAM,IAAIG,KAAK,CAACH,MAAM,CAAC;gBACvBT,UAAU,EAAE,CAAC;aACd,CAAC,CAAC;YAEHF,GAAG,CAACY,IAAI,CAACC,EAAE,CAAC,KAAK,EAAE,IAAM;gBACvBX,UAAU,EAAE,CAAC;aACd,CAAC,CAAC;YAEH,MAAMA,UAAU,GAAG,IAAM;gBACvB,MAAMa,QAAQ,GAAGJ,MAAM,GAAGL,KAAK,AAAC;gBAEhCP,IAAI,CAACG,UAAU,QAIb,GAJFH,KAAAA,CAIE,GAJFA,IAAI,CAACG,UAAU,CAAG;oBAChBa,QAAQ;oBACRT,KAAK;oBACLU,MAAM,EAAEL,MAAM;iBACf,CAAC,AApCV,CAoCW;aACJ,AAAC;SACH;QACD,OAAOX,GAAG,CAAC;KACZ,CAAC;CACH"}