{"version":3,"file":"remoteDevtoolsCorsMiddleware.js","sourceRoot":"","sources":["../../src/middleware/remoteDevtoolsCorsMiddleware.ts"],"names":[],"mappings":";;;AACA,6BAAwC;AAExC,qFAAqF;AACrF,2DAA2D;AAC3D,kDAAkD;AAClD,SAAgB,4BAA4B,CAC1C,GAAoB,EACpB,GAAmB,EACnB,IAA2B;;IAE3B,IAAI,GAAG,CAAC,GAAG,EAAE;QACX,MAAM,GAAG,GAAG,IAAA,WAAQ,EAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAC9B,MAAM,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC;QAClC,MAAM,aAAa,GACjB,MAAM;YACN,CAAC,qBAAqB,EAAE,8CAA8C,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC3F,IAAI,CAAA,MAAA,GAAG,CAAC,QAAQ,0CAAE,QAAQ,CAAC,MAAM,CAAC,KAAI,MAAM,IAAI,aAAa,EAAE;YAC7D,GAAG,CAAC,SAAS,CAAC,6BAA6B,EAAE,MAAM,CAAC,CAAC;YAErD,6DAA6D;YAC7D,MAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC1C,GAAG,CAAC,SAAS,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,EAAE,EAAE;gBAC/B,IAAI,GAAG,KAAK,6BAA6B,EAAE;oBACzC,OAAO;iBACR;gBACD,SAAS,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;YAC1B,CAAC,CAAC;SACH;KACF;IACD,IAAI,EAAE,CAAC;AACT,CAAC;AAzBD,oEAyBC","sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\nimport { parse as parseUrl } from 'url';\n\n// Middleware that accepts multiple Access-Control-Allow-Origin for processing *.map.\n// This is a hook middleware before metro processing *.map,\n// which originally allow only devtools://devtools\nexport function remoteDevtoolsCorsMiddleware(\n  req: IncomingMessage,\n  res: ServerResponse,\n  next: (err?: Error) => void\n) {\n  if (req.url) {\n    const url = parseUrl(req.url);\n    const origin = req.headers.origin;\n    const isValidOrigin =\n      origin &&\n      ['devtools://devtools', 'https://chrome-devtools-frontend.appspot.com'].includes(origin);\n    if (url.pathname?.endsWith('.map') && origin && isValidOrigin) {\n      res.setHeader('Access-Control-Allow-Origin', origin);\n\n      // Prevent metro overwrite Access-Control-Allow-Origin header\n      const setHeader = res.setHeader.bind(res);\n      res.setHeader = (key, ...args) => {\n        if (key === 'Access-Control-Allow-Origin') {\n          return;\n        }\n        setHeader(key, ...args);\n      };\n    }\n  }\n  next();\n}\n"]}